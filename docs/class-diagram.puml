@startuml
skinparam classAttributeIconSize 0
hide empty fields

package entity {
abstract class User {
  #User(userID: String, name: String, password: String)
  +getUserID(): String
  +getName(): String
  +setName(name: String): void
  +getFilterPreferences(): FilterCriteria
  +setFilterPreferences(filterPreferences: FilterCriteria): void
  +login(password: String): boolean
  +logout(): void
  +changePassword(newPass: String): void
}

class Student {
  +Student(userID: String, name: String, password: String, yearOfStudy: int, major: String)
  +getYearOfStudy(): int
  +getMajor(): String
  +getApplications(): List<Application>
  +apply(internship: Internship, manager: ApplicationManager): boolean
  +withdraw(application: Application, manager: WithdrawalManager, reason: String): WithdrawalRequest
  +acceptPlacement(application: Application, manager: ApplicationManager): void
  +hasAcceptedPlacement(): boolean
  +getAcceptedPlacement(): Application
}

class CompanyRep {
  +CompanyRep(userID: String, name: String, password: String, companyName: String, department: String, position: String, approved: boolean)
  +getCompanyName(): String
  +setCompanyName(companyName: String): void
  +getDepartment(): String
  +getPosition(): String
  +createInternship(manager: InternshipManager, title: String, description: String, level: InternshipLevel, preferredMajor: String, openDate: LocalDate, closeDate: LocalDate, slotCount: int): Internship
  +viewApplications(manager: InternshipManager, internship: Internship): List<Application>
  +toggleVisibility(manager: InternshipManager, internship: Internship, on: boolean): void
  +getInternships(manager: InternshipManager): List<Internship>
  +isApproved(): boolean
  +setApproved(approved: boolean): void
  -ensureApproved(): void
}

class CareerCenterStaff {
  +CareerCenterStaff(userID: String, name: String, password: String, staffDepartment: String)
  +getStaffDepartment(): String
  +setStaffDepartment(staffDepartment: String): void
  +approveInternship(manager: InternshipManager, internship: Internship): void
  +rejectInternship(manager: InternshipManager, internship: Internship): void
  +approveRepAccount(manager: UserManager, request: AccountRequest): void
  +rejectRepAccount(manager: UserManager, request: AccountRequest, notes: String): void
  +processWithdrawal(manager: WithdrawalManager, request: WithdrawalRequest, approve: boolean): void
}

class Application {
  +Application(student: Student, internship: Internship)
  +getStudent(): Student
  +getInternship(): Internship
  +getStatus(): ApplicationStatus
  +setStatus(status: ApplicationStatus): void
  +getTimestamp(): Date
  +isWithdrawalRequested(): boolean
  +markSuccessful(): void
  +markUnsuccessful(): void
  +getWithdrawalRequest(): WithdrawalRequest
  +requestWithdrawal(reason: String): WithdrawalRequest
}

class AccountRequest {
  +AccountRequest(rep: CompanyRep)
  +getRep(): CompanyRep
  +getStatus(): String
  +setStatus(status: String): void
  +getApprover(): CareerCenterStaff
  +setApprover(approver: CareerCenterStaff): void
  +getSubmittedOn(): LocalDateTime
  +getDecisionOn(): LocalDateTime
  +getDecisionNotes(): String
  +setDecisionNotes(decisionNotes: String): void
}

class FilterCriteria {
  +FilterCriteria()
  +FilterCriteria(status: InternshipStatus, preferredMajor: String, level: InternshipLevel, closingDate: LocalDate)
  +getStatus(): InternshipStatus
  +setStatus(status: InternshipStatus): void
  +getPreferredMajor(): String
  +setPreferredMajor(preferredMajor: String): void
  +getLevel(): InternshipLevel
  +setLevel(level: InternshipLevel): void
  +getClosingDate(): LocalDate
  +setClosingDate(closingDate: LocalDate): void
  +matches(internship: Internship): boolean
}

class Internship {
  +Internship(title: String, description: String, companyName: String, repInCharge: CompanyRep)
  +getTitle(): String
  +getDescription(): String
  +getLevel(): InternshipLevel
  +setLevel(level: InternshipLevel): void
  +getPreferredMajor(): String
  +setPreferredMajor(preferredMajor: String): void
  +acceptsMajor(major: String): boolean
  +getOpenDate(): LocalDate
  +setOpenDate(openDate: LocalDate): void
  +getCloseDate(): LocalDate
  +setCloseDate(closeDate: LocalDate): void
  +isVisible(): boolean
  +setVisibility(visibility: boolean): void
  +getStatus(): InternshipStatus
  +setStatus(status: InternshipStatus): void
  +getCompanyName(): String
  +getRepInCharge(): CompanyRep
  +addSlot(slot: InternshipSlot): void
  +getSlots(): List<InternshipSlot>
  +getApplications(): List<Application>
  +addApplication(application: Application): void
  +toggleVisibility(on: boolean): void
  +isFull(): boolean
}

class InternshipSlot {
  +InternshipSlot(slotNumber: int)
  +getSlotNumber(): int
  +getAssignedStudent(): Student
  +assignStudent(student: Student): void
  +release(): void
}

class Notification {
  +Notification(message: String)
  +Notification(message: String, timestamp: LocalDateTime)
  +getMessage(): String
  +getTimestamp(): LocalDateTime
  +toString(): String
}

class WithdrawalRequest {
  +WithdrawalRequest(application: Application, student: Student, reason: String)
  +getApplication(): Application
  +getStudent(): Student
  +getReason(): String
  +getRequestedOn(): LocalDateTime
  +getStatus(): WithdrawalStatus
  +getProcessedBy(): CareerCenterStaff
  +getProcessedOn(): LocalDateTime
  +approve(): void
  +reject(): void
  +setProcessedBy(processedBy: CareerCenterStaff): void
  -transition(targetStatus: WithdrawalStatus): void
}

enum ApplicationStatus {
  PENDING
  SUCCESSFUL
  UNSUCCESSFUL
  WITHDRAWN
}

enum InternshipStatus {
  PENDING
  APPROVED
  REJECTED
  FILLED
}

enum InternshipLevel {
  BASIC
  INTERMEDIATE
  ADVANCED
}

enum WithdrawalStatus {
  PENDING
  WITHDRAWN
  REJECTED
}
}

package control {
class ApplicationManager {
  +submitApplication(student: Student, internship: Internship): Application
  +updateStatus(application: Application, status: ApplicationStatus): void
  +updateStatus(application: Application, status: ApplicationStatus, confirmOffer: boolean): void
  +enforceRules(student: Student, internship: Internship): boolean
  +getLastFailureReason(): String
  +setNotificationManager(notificationManager: NotificationManager): void
  -assignSlot(application: Application): void
  -releaseSlot(application: Application): void
  -markOtherApplications(acceptedApplication: Application): void
  -notifyStudentOfSuccessfulApplication(application: Application): void
}

class InternshipManager {
  +submitInternship(internship: Internship): Internship
  +approveInternship(internship: Internship): void
  +rejectInternship(internship: Internship): void
  +refreshStatuses(): void
  +filter(criteria: FilterCriteria): List<Internship>
  +getInternships(): List<Internship>
  +getInternshipsForRep(rep: CompanyRep): List<Internship>
  +removeInternships(rep: CompanyRep, targets: Collection<Internship>): void
}

class NotificationManager {
  +notifyUser(user: User, message: String): void
  +notifyUsers(users: Collection<? extends User>, message: String): void
  +notifyStaffNewRepRegistration(staff: Collection<CareerCenterStaff>, repName: String, repId: String, companyName: String): void
  +notifyStaffWithdrawalRequest(staff: Collection<CareerCenterStaff>, student: Student, internship: Internship): void
  +notifyStaffInternshipSubmission(staff: Collection<CareerCenterStaff>, internship: Internship): void
  +notifyStaffWorkloadReminder(staff: CareerCenterStaff, pendingInternships: int, pendingWithdrawals: int): void
  +notifyRepAccountDecision(rep: CompanyRep, approved: boolean, notes: String): void
  +notifyStudentOfferAwaitingAcceptance(application: Application): void
  +clearNotificationsForUsers(users: Collection<? extends User>, condition: Predicate<Notification>): void
  +notifyRepNewApplication(rep: CompanyRep, student: Student, internship: Internship): void
  +consumeNotifications(user: User): List<Notification>
  +peekNotifications(user: User): List<Notification>
  +hasNotifications(user: User): boolean
}

class ReportGenerator {
  +generateByStatus(internships: List<Internship>, status: InternshipStatus): void
  +generateByMajor(internships: List<Internship>, major: String): void
  +generateByLevel(internships: List<Internship>, level: InternshipLevel): void
  +generateCompanySummary(internships: List<Internship>, company: String): void
  -printReport(title: String, internships: List<Internship>): void
  -formatPreferredMajor(internship: Internship): String
}

class SchoolMajorCatalog {
  +SchoolMajorCatalog(csvFile: File)
  +isEmpty(): boolean
  +getSchools(): List<String>
  +getMajorsForSchool(school: String): List<String>
  -load(file: File): void
}

class UserManager {
  +loadAllUsers(studentFile: File, staffFile: File, companyFile: File): void
  +login(id: String, pass: String): User
  +getLastLoginMessage(): String
  +resetPassword(id: String, newPassword: String): boolean
  +registerStudent(id: String, name: String, password: String, year: int, major: String): boolean
  +registerCompanyRep(id: String, name: String, password: String, companyName: String, department: String, position: String, approved: boolean): boolean
  +registerCareerCenterStaff(id: String, name: String, password: String, department: String): boolean
  +approveRepresentative(repId: String, approver: CareerCenterStaff): boolean
  +rejectRepresentative(repId: String, approver: CareerCenterStaff, notes: String): boolean
  +getPendingAccounts(): List<AccountRequest>
  +getPendingAccounts(page: int, pageSize: int, statusFilter: String): List<AccountRequest>
  +getCareerCenterStaffMembers(): List<CareerCenterStaff>
  -loadStudents(file: File): void
  -loadStaff(file: File): void
  -loadCompanyRepresentatives(file: File): void
  -addUser(user: User): boolean
  -userExists(id: String): boolean
  -isReadable(file: File): boolean
  -parseInt(value: String, fallback: int): int
  -findUser(id: String): User
  -findRequest(repId: String): AccountRequest
}

class WithdrawalManager {
  +submitRequest(app: Application, reason: String): WithdrawalRequest
  +processRequest(request: WithdrawalRequest, staff: CareerCenterStaff, approve: boolean): boolean
  +getPendingRequests(): List<WithdrawalRequest>
  -releaseSlot(application: Application): void
}
}

package boundary {
class ConsoleHelper {
  +ConsoleHelper(scanner: Scanner, catalog: SchoolMajorCatalog)
  +readLine(prompt: String): String
  +promptPasswordInput(prompt: String): String
  +promptYesNo(prompt: String, defaultYes: boolean): boolean
  +readInt(prompt: String, min: int, max: int, defaultValue: Integer, allowCancel: boolean): Integer
  +readInt(prompt: String, min: int, max: int): int
  +readOptionalDate(prompt: String): LocalDate
  +promptInternshipLevel(): InternshipLevel
  +promptStatusSelection(): InternshipStatus
  +promptStudentMajorSelection(): String
  +promptPreferredMajorSelection(): String
  +selectInternshipFromList(internships: List<Internship>): Internship
  +selectApplicationFromList(applications: List<Application>, prompt: String): Application
  +printInternshipRow(index: int, internship: Internship): void
}

class InternshipBrowser {
  +InternshipBrowser(manager: InternshipManager, console: ConsoleHelper)
  +fetchFilteredInternships(user: User, filter: Predicate<Internship>): List<Internship>
}

class App {
  +App()
  +{static} main(args: String[]): void
  +start(): void
  -loadInitialUsers(): void
  -promptLogin(): User
  -handlePasswordReset(id: String): void
  -readPassword(prompt: String): String
  -routeUser(user: User): void
  -handleRegistration(): void
  -registerStudent(): void
  -registerCompanyRep(): void
  -registerCareerCenterStaff(): void
  -persistStudentRecord(id: String, name: String, major: String, year: int): void
  -persistCompanyRepRecord(id: String, name: String, company: String, department: String, position: String): void
  -persistStaffRecord(id: String, name: String, department: String): void
  -appendCsvLine(path: String, header: String, line: String): void
  -displayNotifications(user: User): void
  -updateCompanyRepApproval(repId: String, approved: boolean): void
}
}

package menu {
class StudentMenu {
  +StudentMenu(console: ConsoleHelper, browser: InternshipBrowser, applicationManager: ApplicationManager, internshipManager: InternshipManager, notificationManager: NotificationManager, withdrawalManager: WithdrawalManager, userManager: UserManager, notificationDisplay: Consumer<User>, passwordChanger: Consumer<User>)
  +show(student: Student): void
}

class CompanyRepMenu {
  +CompanyRepMenu(console: ConsoleHelper, browser: InternshipBrowser, internshipManager: InternshipManager, applicationManager: ApplicationManager, notificationManager: NotificationManager, userManager: UserManager, notificationDisplay: Consumer<User>, passwordChanger: Consumer<User>)
  +show(rep: CompanyRep): void
}

class StaffMenu {
  +StaffMenu(console: ConsoleHelper, internshipManager: InternshipManager, userManager: UserManager, withdrawalManager: WithdrawalManager, notificationManager: NotificationManager, reportGenerator: ReportGenerator, notificationDisplay: Consumer<User>, passwordChanger: Consumer<User>, approvalUpdater: BiConsumer<String, Boolean>)
  +show(staff: CareerCenterStaff): void
}
}

Student --|> User
CompanyRep --|> User
CareerCenterStaff --|> User

User "1" --> "0..1" FilterCriteria : filterPreferences
Student "1" o-- "0..*" Application : applications
Application "1" --> "1" Student : student
CompanyRep "1" o-- "0..*" Internship : internships
Internship "1" --> "1" CompanyRep : repInCharge
Internship "1" o-- "0..*" InternshipSlot : slots
InternshipSlot "1" --> "0..1" Student : assignedStudent
Internship "1" o-- "0..*" Application : applications
Application "1" --> "1" Internship : internship
Application "1" --> "0..1" WithdrawalRequest : withdrawalRequest
WithdrawalRequest "1" --> "1" Application : application
WithdrawalRequest "1" --> "1" Student : student
WithdrawalRequest "1" --> "0..1" CareerCenterStaff : processedBy
WithdrawalManager "1" o-- "0..*" WithdrawalRequest : requests
ApplicationManager "1" --> "0..1" NotificationManager : notificationManager
NotificationManager "1" o-- "0..*" Notification : inbox
UserManager "1" o-- "0..*" User : users
UserManager "1" o-- "0..*" AccountRequest : accountRequests
AccountRequest "1" --> "1" CompanyRep : rep
AccountRequest "1" --> "0..1" CareerCenterStaff : approver
InternshipManager "1" o-- "0..*" Internship : internships
Application "1" --> "1" ApplicationStatus : status
Internship "1" --> "1" InternshipStatus : status
Internship "1" --> "0..1" InternshipLevel : level
FilterCriteria "1" --> "0..1" InternshipStatus : status
FilterCriteria "1" --> "0..1" InternshipLevel : level
WithdrawalRequest "1" --> "1" WithdrawalStatus : status
App "1" --> "1" UserManager
App "1" --> "1" InternshipManager
App "1" --> "1" ApplicationManager
App "1" --> "1" NotificationManager
App "1" --> "1" WithdrawalManager
App "1" --> "1" ReportGenerator
App "1" --> "1" SchoolMajorCatalog
App "1" --> "1" ConsoleHelper
App "1" --> "1" InternshipBrowser
App "1" --> "1" StudentMenu
App "1" --> "1" CompanyRepMenu
App "1" --> "1" StaffMenu

@enduml
